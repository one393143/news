<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>æ¥µé™æ£’çƒé™£å®¹å¤§å¸«</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">
<style>
body{font-family:'Noto Sans TC',sans-serif;background-color:#020617;color:#f8fafc;overflow-x:hidden;-webkit-tap-highlight-color:transparent}
.baseball-field{background:radial-gradient(circle at center,#16a34a 0%,#14532d 100%);position:relative;aspect-ratio:1/1;border-radius:10% 10% 50% 50%;border:4px solid #064e3b;box-shadow:inset 0 0 60px rgba(0,0,0,0.6)}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:#1e293b}::-webkit-scrollbar-thumb{background:#475569;border-radius:2px}
@keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.animate-slide-up{animation:slideUp 0.3s ease-out forwards}
.card-shadow{box-shadow:0 10px 25px -5px rgba(0,0,0,0.4),0 8px 10px -6px rgba(0,0,0,0.4)}
.diamond-inner{position:absolute;left:50%;top:55%;width:42%;height:42%;border:2px solid rgba(255,255,255,0.15);transform:translate(-50%,-50%) rotate(45deg);pointer-events:none}
.base-indicator{width:36px;height:36px;border:2px solid rgba(255,255,255,0.2);transform:rotate(45deg);transition:all 0.2s cubic-bezier(0.4,0,0.2,1);display:flex;align-items:center;justify-content:center}
.base-indicator>span{transform:rotate(-45deg);font-size:11px;font-weight:900}
.base-active{background-color:#facc15;border-color:#fff;box-shadow:0 0 20px #facc15;color:#000}
.game-layout{display:grid;grid-template-columns:1fr;gap:1rem}
@media(min-width:1024px){.game-layout{grid-template-columns:320px 1fr;gap:2rem}}
.sync-indicator{display:inline-block;width:8px;height:8px;border-radius:50%;background-color:#10b981;animation:pulse 2s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.5}}
</style>
</head>
<body>
<div id="root"></div>
<script type="module">
import{initializeApp}from'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
import{getFirestore,doc,setDoc,onSnapshot}from'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
const firebaseConfig={apiKey:"AIzaSyAwmH0zHsXFWP7Lt5RtSgbJCRljtMOwAL8",authDomain:"baseball-roster-manager-71b72.firebaseapp.com",projectId:"baseball-roster-manager-71b72",storageBucket:"baseball-roster-manager-71b72.firebasestorage.app",messagingSenderId:"423902203072",appId:"1:423902203072:web:a670744b7d08a53bcab125",measurementId:"G-XVBBJ63WQ2"};
const app=initializeApp(firebaseConfig);const db=getFirestore(app);
window.firebaseDB=db;window.firebaseDoc=doc;window.firebaseSetDoc=setDoc;window.firebaseOnSnapshot=onSnapshot;
console.log('âœ… Firebase å·²åˆå§‹åŒ–');
</script>
<script type="text/babel">
const{useState,useEffect,useMemo,useRef}=React;
const ALL_POSITIONS=['P','C','1B','2B','3B','SS','LF','CF','RF','FE','DH1','DH2','DH3'];
const DEFAULT_PLAYERS=[{id:'1',name:'ç‹å¤§å¼·',number:'1',primaryPosition:'P',secondaryPositions:['DH1'],stats:{power:65,contact:60,speed:55,defense:95}},{id:'2',name:'æé‡ç ²',number:'24',primaryPosition:'RF',secondaryPositions:['1B','DH2'],stats:{power:95,contact:75,speed:40,defense:70}},{id:'3',name:'å¼µé–ƒé›»',number:'7',primaryPosition:'SS',secondaryPositions:['2B','CF','FE'],stats:{power:55,contact:88,speed:98,defense:90}},{id:'4',name:'é™³å®‰æ‰“',number:'31',primaryPosition:'CF',secondaryPositions:['LF','RF','FE'],stats:{power:70,contact:92,speed:85,defense:85}},{id:'5',name:'æ—éŠ…ç‰†',number:'10',primaryPosition:'C',secondaryPositions:['1B'],stats:{power:75,contact:65,speed:35,defense:98}}];
const StatBar=({label,value,color})=>(<div className="flex flex-col gap-0.5 w-full"><div className="flex justify-between text-[8px] font-black uppercase text-white/70"><span>{label}</span><span>{value}</span></div><div className="h-1 w-full bg-black/40 rounded-full overflow-hidden"><div className={`h-full ${color} transition-all duration-700 ease-out`}style={{width:`${Math.min(value,100)}%`}}/></div></div>);
const PlayerCard=({player,onClick,selected,showStats=true,compact=false,showSecondary=true})=>{if(!player)return null;const avg=(player.stats.power+player.stats.contact+player.stats.speed+player.stats.defense)/4;const rarity=avg>=90?'from-amber-400 to-orange-600':avg>=80?'from-purple-500 to-blue-900':avg>=70?'from-emerald-500 to-cyan-900':'from-slate-600 to-slate-800';if(compact){return(<div onClick={onClick}className={`p-3 rounded-xl border-2 flex items-center gap-3 ${onClick?'cursor-pointer':''} transition-all active:scale-95 bg-gradient-to-br ${rarity} shadow-md border-white/10`}><span className="text-[10px] font-black opacity-60">#{player.number}</span><span className="text-sm font-black truncate flex-1">{player.name}</span><span className="text-[9px] font-black bg-black/30 px-2 py-0.5 rounded uppercase">{player.primaryPosition}</span></div>)}return(<div onClick={onClick}className={`relative flex flex-col p-4 rounded-2xl border-2 transition-all ${onClick?'cursor-pointer':''} active:scale-95 bg-gradient-to-br ${rarity} border-white/10 card-shadow ${selected?'ring-4 ring-cyan-400 border-white':''}`}><div className="flex justify-between items-start mb-2 relative z-10"><div className="flex flex-col"><span className="text-[10px] font-black uppercase opacity-70">No.{player.number}</span><h3 className="text-lg font-black drop-shadow-md leading-tight">{player.name}</h3></div><div className="bg-black/30 px-2 py-1 rounded-lg font-black text-[11px]">{player.primaryPosition}</div></div>{showSecondary&&player.secondaryPositions&&player.secondaryPositions.length>0&&(<div className="flex flex-wrap gap-1 mb-3 relative z-10">{player.secondaryPositions.map(pos=>(<span key={pos}className="text-[8px] bg-white/10 px-2 py-0.5 rounded font-bold uppercase">{pos}</span>))}</div>)}{showStats&&(<div className="grid grid-cols-2 gap-x-4 gap-y-2 mt-auto"><StatBar label="PWR"value={player.stats.power}color="bg-red-500"/><StatBar label="CON"value={player.stats.contact}color="bg-blue-500"/><StatBar label="SPD"value={player.stats.speed}color="bg-green-500"/><StatBar label="DEF"value={player.stats.defense}color="bg-orange-500"/></div>)}</div>)};
const App=()=>{const[activeTab,setActiveTab]=useState('field');const[players,setPlayers]=useState(DEFAULT_PLAYERS);const[lineup,setLineup]=useState({});const[battingOrder,setBattingOrder]=useState([]);const[pitcherBats,setPitcherBats]=useState(false);const[selectingPosition,setSelectingPosition]=useState(null);const[editingPlayer,setEditingPlayer]=useState(null);const[isLoading,setIsLoading]=useState(true);const[isSynced,setIsSynced]=useState(false);const isUpdatingFromFirebase=useRef(false);const[gameState,setGameState]=useState({inning:1,score:{team:0,enemy:0},bases:{1:null,2:null,3:null},batterIndex:0,outs:0,history:[]});const[selectedBase,setSelectedBase]=useState(null);const[substitutingInGame,setSubstitutingInGame]=useState(null);
useEffect(()=>{if(!window.firebaseDB){console.error('âŒ Firebase æœªåˆå§‹åŒ–');setIsLoading(false);return}const docRef=window.firebaseDoc(window.firebaseDB,"baseballData","current");console.log('ğŸ”„ é–‹å§‹ç›£è½ Firebase...');const unsubscribe=window.firebaseOnSnapshot(docRef,(snapshot)=>{console.log('ğŸ“¥ æ”¶åˆ° Firebase æ›´æ–°');if(snapshot.exists()){const data=snapshot.data();console.log('âœ… è³‡æ–™:',data);isUpdatingFromFirebase.current=true;setPlayers(data.players||DEFAULT_PLAYERS);setLineup(data.lineup||{});setBattingOrder(data.battingOrder||[]);setPitcherBats(data.pitcherBats||false);setIsSynced(true);setTimeout(()=>{isUpdatingFromFirebase.current=false},100)}else{console.log('ğŸ“ åˆæ¬¡å»ºç«‹è³‡æ–™');const defaultData={players:DEFAULT_PLAYERS,lineup:{},battingOrder:[],pitcherBats:false};saveToFirebase(defaultData)}setIsLoading(false)},(error)=>{console.error("âŒ Firebase éŒ¯èª¤:",error);setIsLoading(false)});return()=>unsubscribe()},[]);
const saveToFirebase=async(data)=>{if(isUpdatingFromFirebase.current){console.log('â­ï¸ è·³é (ä¾†è‡ª Firebase çš„æ›´æ–°)');return}if(!window.firebaseDB)return;try{console.log('ğŸ’¾ å„²å­˜åˆ° Firebase...');const docRef=window.firebaseDoc(window.firebaseDB,"baseballData","current");await window.firebaseSetDoc(docRef,{players:data.players!==undefined?data.players:players,lineup:data.lineup!==undefined?data.lineup:lineup,battingOrder:data.battingOrder!==undefined?data.battingOrder:battingOrder,pitcherBats:data.pitcherBats!==undefined?data.pitcherBats:pitcherBats,lastUpdated:new Date()});console.log('âœ… å„²å­˜æˆåŠŸ');setIsSynced(true)}catch(error){console.error("âŒ å„²å­˜å¤±æ•—:",error);setIsSynced(false)}};
useEffect(()=>{if(!isLoading&&!isUpdatingFromFirebase.current){console.log('ğŸ”„ è³‡æ–™è®Šæ›´ï¼Œæº–å‚™åŒæ­¥');saveToFirebase({players,lineup,battingOrder,pitcherBats})}},[players,lineup,battingOrder,pitcherBats]);
useEffect(()=>{const onField=Object.entries(lineup).filter(([pos,pid])=>pid);let currentOrder=battingOrder.filter(e=>{const pos=Object.keys(lineup).find(k=>lineup[k]===e.playerId);return pos&&(pitcherBats||pos!=='P')});const orderIds=new Set(currentOrder.map(e=>e.playerId));const missing=onField.filter(([pos,pid])=>!orderIds.has(pid)&&(pitcherBats||pos!=='P')).map(([pos,pid])=>({playerId:pid,position:pos}));if(missing.length>0){setBattingOrder(prev=>[...currentOrder,...missing])}else if(currentOrder.length!==battingOrder.length){setBattingOrder(currentOrder)}},[lineup,pitcherBats]);
const updateGameState=(updates)=>{setGameState(prev=>{const newState={...prev,...updates};const history=[prev,...prev.history].slice(0,10);return{...newState,history}})};
const undoAction=()=>{if(gameState.history.length===0)return;const[last,...rest]=gameState.history;setGameState({...last,history:rest})};
const handleDeletePlayer=(id)=>{if(!window.confirm('ç¢ºå®šè¦åˆªé™¤é€™ä½çƒå“¡å—ï¼Ÿç›¸é—œçš„å®ˆå‚™èˆ‡æ‰“ç·šä¹Ÿå°‡è¢«æ¸…é™¤ã€‚'))return;setPlayers(prev=>prev.filter(p=>p.id!==id));setLineup(prev=>{const next={...prev};Object.keys(next).forEach(key=>{if(next[key]===id)delete next[key]});return next});setBattingOrder(prev=>prev.filter(item=>item.playerId!==id));setSubstitutingInGame(prev=>(prev&&prev.oldId===id)?null:prev)};
const handlePAResult=(result)=>{let{bases,batterIndex,outs,score}=JSON.parse(JSON.stringify(gameState));const currentBatter=battingOrder[batterIndex];if(!currentBatter)return alert('æ‰“ç·šè³‡æ–™ä¸è¶³');if(result==='OUT'){outs++}else if(result==='1B'){if(bases[3])score.team++;bases[3]=bases[2];bases[2]=bases[1];bases[1]=currentBatter.playerId}else if(result==='2B'){if(bases[3])score.team++;if(bases[2])score.team++;bases[3]=bases[1];bases[2]=currentBatter.playerId;bases[1]=null}else if(result==='3B'){[1,2,3].forEach(b=>{if(bases[b])score.team++});bases[3]=currentBatter.playerId;bases[2]=null;bases[1]=null}else if(result==='HR'){let runs=1;[1,2,3].forEach(b=>{if(bases[b])runs++});score.team+=runs;bases={1:null,2:null,3:null}}if(outs>=3){outs=0;bases={1:null,2:null,3:null}}batterIndex=(batterIndex+1)%(battingOrder.length||1);updateGameState({bases,batterIndex,outs,score})};
const handleBaseAction=(target)=>{let{bases,score,outs}=JSON.parse(JSON.stringify(gameState));const pid=bases[selectedBase];if(!pid)return;if(target==='HOME'){score.team++;bases[selectedBase]=null}else if(target==='OUT'){outs++;bases[selectedBase]=null}else{if(bases[target])return alert('è©²å£˜å·²æœ‰è·‘è€…ï¼');bases[target]=pid;bases[selectedBase]=null}updateGameState({bases,score,outs});setSelectedBase(null)};
const bench=useMemo(()=>{const assigned=new Set(Object.values(lineup));return players.filter(p=>!assigned.has(p.id))},[players,lineup]);
const battingSubstitutes=useMemo(()=>{const inLineup=new Set(battingOrder.map(e=>e.playerId));return players.filter(p=>!inLineup.has(p.id))},[players,battingOrder]);
const sortedPlayersForSelection=useMemo(()=>{if(!selectingPosition)return[];const onOtherPos=new Set(Object.entries(lineup).filter(([pos,pid])=>pos!==selectingPosition&&pid).map(([pos,pid])=>pid));return[...players].filter(p=>!onOtherPos.has(p.id)).sort((a,b)=>{const getPriority=(p)=>{if(p.primaryPosition===selectingPosition)return 0;if(p.secondaryPositions?.includes(selectingPosition))return 1;return 2};const getAvg=(p)=>(p.stats.power+p.stats.contact+p.stats.speed+p.stats.defense)/4;const pA=getPriority(a),pB=getPriority(b);if(pA!==pB)return pA-pB;return getAvg(b)-getAvg(a)})},[players,lineup,selectingPosition]);
const autoOptimizeBatting=()=>{const activeOnField=Object.entries(lineup).filter(([pos,pid])=>pid&&(pitcherBats||pos!=='P')).map(([pos,pid])=>({pos,player:players.find(p=>p.id===pid)})).filter(x=>x.player);if(activeOnField.length===0)return;let pool=[...activeOnField];let optimized=[];pool.sort((a,b)=>(b.player.stats.speed*1.5+b.player.stats.contact)-(a.player.stats.speed*1.5+a.player.stats.contact));for(let i=0;i<2&&pool.length>0;i++)optimized.push(pool.shift());pool.sort((a,b)=>(b.player.stats.power*1.5+b.player.stats.contact)-(a.player.stats.power*1.5+a.player.stats.contact));for(let i=0;i<3&&pool.length>0;i++)optimized.push(pool.shift());pool.sort((a,b)=>b.player.stats.contact-a.player.stats.contact);optimized=[...optimized,...pool];setBattingOrder(optimized.map(item=>({playerId:item.player.id,position:item.pos})))};
const autoOptimizeDefense=()=>{if(!window.confirm('è‡ªå‹•æœ€ä½³åŒ–å®ˆå‚™ä½ç½®ï¼Ÿé€™æœƒæ¸…é™¤ç›®å‰çš„é™£å®¹é…ç½®ã€‚'))return;const positionPriority={P:['P'],C:['C'],SS:['SS','2B','3B'],CF:['CF','LF','RF'],RF:['RF','LF','CF'],'2B':['2B','SS','3B'],'3B':['3B','2B','SS'],'1B':['1B','3B','C'],LF:['LF','CF','RF'],FE:['FE','CF','LF','RF']};const newLineup={};const assigned=new Set();const sortedPlayers=[...players].sort((a,b)=>{const avgA=(a.stats.power+a.stats.contact+a.stats.speed+a.stats.defense)/4;const avgB=(b.stats.power+b.stats.contact+b.stats.speed+b.stats.defense)/4;return avgB-avgA});ALL_POSITIONS.slice(0,10).forEach(pos=>{const candidate=sortedPlayers.find(p=>{if(assigned.has(p.id))return false;if(p.primaryPosition===pos)return true;if(p.secondaryPositions?.includes(pos))return true;return false});if(candidate){newLineup[pos]=candidate.id;assigned.add(candidate.id)}});setLineup(newLineup)};
const handleExportExcel=()=>{const data=players.map(p=>({'å§“å':p.name,'èƒŒè™Ÿ':p.number,'ä¸»è¦ä½ç½®':p.primaryPosition,'æ¬¡è¦ä½ç½®':p.secondaryPositions?.join(','),'åŠ›é‡':p.stats.power,'æ‰“æ“Š':p.stats.contact,'é€Ÿåº¦':p.stats.speed,'å®ˆå‚™':p.stats.defense}));const ws=XLSX.utils.json_to_sheet(data);const wb=XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb,ws,"çƒå“¡åå†Š");XLSX.writeFile(wb,"Roster_Master.xlsx")};
const handleImportExcel=(e)=>{const file=e.target.files[0];if(!file)return;const r=new FileReader();r.onload=(evt)=>{const ws=XLSX.read(evt.target.result,{type:'binary'}).Sheets[XLSX.read(evt.target.result,{type:'binary'}).SheetNames[0]];const data=XLSX.utils.sheet_to_json(ws);setPlayers(prev=>[...prev,...data.map((d,i)=>({id:'imp-'+Date.now()+i,name:d.å§“å||'çƒå“¡',number:String(d.èƒŒè™Ÿ||'0'),primaryPosition:d.ä¸»è¦ä½ç½®||'P',secondaryPositions:d.æ¬¡è¦ä½ç½®?String(d.æ¬¡è¦ä½ç½®).split(','):[],stats:{power:d.åŠ›é‡||50,contact:d.æ‰“æ“Š||50,speed:d.é€Ÿåº¦||50,defense:d.å®ˆå‚™||50}}))])};r.readAsBinaryString(file)};
const assignPlayer=(pid)=>{const nl={...lineup};Object.keys(nl).forEach(k=>{if(nl[k]===pid)delete nl[k]});nl[selectingPosition]=pid;setLineup(nl);setSelectingPosition(null)};
const renderFieldSlot=(pos,top,left)=>{const p=players.find(x=>x.id===lineup[pos]);return(<div key={pos}onClick={()=>setSelectingPosition(pos)}className="absolute transform -translate-x-1/2 -translate-y-1/2 z-20 cursor-pointer"style={{top,left}}><div className={`w-14 h-14 md:w-16 md:h-16 rounded-full border-2 flex flex-col items-center justify-center transition-all ${p?'bg-slate-900 border-yellow-400 scale-110 shadow-lg':'bg-black/30 border-white/20'}`}><span className="text-[10px] font-black opacity-50">{pos}</span><span className="text-[11px] font-bold truncate px-1 text-white">{p?p.name:'+'}</span></div></div>)};
const renderGameView=()=>(<div className="game-layout animate-slide-up pb-24"><div className="bg-slate-900/40 rounded-3xl border border-white/5 p-4 space-y-3"><div className="flex justify-between items-center mb-2 px-1"><h3 className="text-xs font-black text-cyan-400 tracking-widest uppercase">Order List</h3><span className="text-[10px] text-slate-500 font-bold">é»æ“Šçƒå“¡é€²è¡Œæ›´æ›</span></div><div className="grid grid-cols-1 gap-2 max-h-[40vh] lg:max-h-[60vh] overflow-y-auto pr-1">{battingOrder.map((e,idx)=>{const p=players.find(x=>x.id===e.playerId);const isCurrent=gameState.batterIndex===idx;return(<div key={idx}onClick={()=>setSubstitutingInGame({idx,pos:e.position,oldId:e.playerId})}className={`flex items-center gap-3 p-3 rounded-2xl border transition-all cursor-pointer active:opacity-70 ${isCurrent?'bg-cyan-600/90 border-cyan-400 scale-[1.02] shadow-[0_0_20px_rgba(34,211,238,0.4)]':'bg-slate-800/80 border-white/5 opacity-70'}`}><div className={`w-8 h-8 rounded-full flex items-center justify-center font-black text-xs ${isCurrent?'bg-white text-cyan-700':'bg-slate-950 text-slate-600'}`}>{idx+1}</div><div className="flex-1"><div className="font-black text-sm truncate">{p?.name||'æœªçŸ¥'}</div><div className={`text-[9px] font-bold uppercase ${isCurrent?'text-white/60':'text-slate-500'}`}>{e.position}</div></div>{isCurrent&&<div className="animate-pulse text-xl">âš¾</div>}</div>)})}</div></div><div className="space-y-6"><div className="bg-slate-900 p-6 rounded-[2rem] border border-white/10 shadow-2xl space-y-6"><div className="grid grid-cols-1 md:grid-cols-2 gap-4 bg-slate-800/30 p-4 rounded-3xl"><div className="flex justify-between items-center bg-slate-900/50 p-3 rounded-2xl"><div className="text-center"><span className="text-[10px] block text-slate-500 font-black">INNING</span><div className="flex items-center gap-3"><button onClick={()=>updateGameState({inning:Math.max(1,gameState.inning-1)})}className="w-8 h-8 rounded-full bg-slate-700 flex items-center justify-center font-bold">ï¼</button><span className="text-2xl font-black">{gameState.inning}</span><button onClick={()=>updateGameState({inning:gameState.inning+1})}className="w-8 h-8 rounded-full bg-slate-700 flex items-center justify-center font-bold">ï¼‹</button></div></div><div className="text-center"><span className="text-[10px] block text-slate-500 font-black">OUTS</span><div className="flex gap-2 mt-1 justify-center">{[1,2].map(i=>(<div key={i}onClick={()=>updateGameState({outs:gameState.outs===i?i-1:i})}className={`w-4 h-4 rounded-full cursor-pointer transition-all border-2 border-slate-700 ${gameState.outs>=i?'bg-red-500 border-red-300 shadow-[0_0_12px_rgba(239,68,68,0.7)]':'bg-slate-950'}`}/>))}</div></div></div><div className="flex items-center justify-around bg-slate-900/50 p-3 rounded-2xl"><div className="text-center"><span className="text-[10px] block text-cyan-400 font-black tracking-widest uppercase">My Team</span><div className="flex items-center gap-3 mt-1"><button onClick={()=>updateGameState({score:{...gameState.score,team:Math.max(0,gameState.score.team-1)}})}className="w-7 h-7 rounded-full bg-slate-700 flex items-center justify-center font-black">ï¼</button><span className="text-3xl font-black">{gameState.score.team}</span><button onClick={()=>updateGameState({score:{...gameState.score,team:gameState.score.team+1}})}className="w-7 h-7 rounded-full bg-slate-700 flex items-center justify-center font-black">ï¼‹</button></div></div><div className="text-2xl font-black text-slate-700">:</div><div className="text-center"><span className="text-[10px] block text-red-400 font-black tracking-widest uppercase">Enemy</span><div className="flex items-center gap-3 mt-1"><button onClick={()=>updateGameState({score:{...gameState.score,enemy:Math.max(0,gameState.score.enemy-1)}})}className="w-7 h-7 rounded-full bg-slate-700 flex items-center justify-center font-black">ï¼</button><span className="text-3xl font-black">{gameState.score.enemy}</span><button onClick={()=>updateGameState({score:{...gameState.score,enemy:gameState.score.enemy+1}})}className="w-7 h-7 rounded-full bg-slate-700 flex items-center justify-center font-black">ï¼‹</button></div></div></div></div><div className="flex flex-col md:flex-row items-center gap-8"><div className="relative w-36 h-36 flex-shrink-0 mt-2">{[1,2,3].map(b=>{const rId=gameState.bases[b];const r=players.find(x=>x.id===rId);return(<div key={b}onClick={()=>rId&&setSelectedBase(b)}className={`absolute base-indicator cursor-pointer z-10 ${rId?'base-active':''}`}style={b===1?{right:'0',top:'50px'}:b===2?{top:'0',left:'54px'}:{left:'0',top:'50px'}}><span>{r?r.name.charAt(0):b}</span>{rId&&<div className="absolute -top-11 -right-2 bg-slate-900 border border-white/20 text-[8px] px-2 py-0.5 rounded-lg font-black whitespace-nowrap rotate-[-45deg] shadow-lg">{r.name}</div>}</div>)})}<div className="absolute bottom-0 left-14 w-9 h-9 bg-slate-800/50 border-2 border-white/10 transform rotate-45 flex items-center justify-center"><span className="rotate-[-45deg] text-[9px] font-black opacity-20 uppercase">Home</span></div></div><div className="flex-1 w-full space-y-4"><div className="bg-slate-800/40 p-4 rounded-3xl border border-white/5 space-y-3"><div><span className="text-[10px] font-black text-slate-500 uppercase tracking-widest">At Bat</span><div className="text-xl font-black text-cyan-400">{players.find(x=>x.id===battingOrder[gameState.batterIndex]?.playerId)?.name||'---'}</div></div><div><span className="text-[10px] font-black text-slate-500 uppercase tracking-widest">Next Batters</span><div className="flex gap-2 mt-1">{[1,2,3].map(offset=>{const idx=(gameState.batterIndex+offset)%(battingOrder.length||1);const p=players.find(x=>x.id===battingOrder[idx]?.playerId);return(<div key={offset}className="flex-1 min-w-[60px] bg-slate-900/80 px-2 py-1.5 rounded-xl border border-white/5 text-center"><div className="text-[8px] text-slate-500 font-black">#{idx+1}</div><div className="text-[10px] font-bold truncate">{p?.name||'-'}</div></div>)})}</div></div></div><button onClick={undoAction}disabled={gameState.history.length===0}className={`w-full py-3 rounded-2xl font-black text-[10px] uppercase transition-all flex items-center justify-center gap-2 ${gameState.history.length===0?'bg-slate-800 text-slate-600 opacity-20':'bg-indigo-600/20 text-indigo-400 border border-indigo-500/30 active:scale-95'}`}>â†© Undo Last Action</button></div></div></div><div className="grid grid-cols-2 sm:grid-cols-5 gap-2">{['1B','2B','3B','HR','OUT'].map(res=>(<button key={res}onClick={()=>handlePAResult(res)}className={`py-5 rounded-2xl font-black text-base tracking-widest transition-all active:scale-90 shadow-lg border-2 ${res==='OUT'?'bg-red-600 border-red-400 text-white':'bg-slate-800 border-white/10 text-white'}`}>{res}</button>))}</div></div>{selectedBase&&(<div className="fixed inset-0 z-[60] flex items-center justify-center bg-black/85 p-6 backdrop-blur-md"><div className="bg-slate-900 p-8 rounded-[2.5rem] border-2 border-white/10 w-full max-w-xs shadow-2xl animate-slide-up"><h3 className="text-center font-black mb-6 uppercase tracking-widest text-cyan-400 text-lg">Runner Move({selectedBase}B)</h3><div className="grid grid-cols-1 gap-3">{[1,2,3].map(b=>b!==selectedBase&&(<button key={b}onClick={()=>handleBaseAction(b)}className="py-4 bg-slate-800 rounded-2xl font-black uppercase text-sm border border-white/5 active:bg-slate-700">Advance to{b}B</button>))}<button onClick={()=>handleBaseAction('HOME')}className="py-4 bg-yellow-600 rounded-2xl font-black text-black uppercase text-sm active:scale-95 shadow-lg">Score at Home</button><button onClick={()=>handleBaseAction('OUT')}className="py-4 bg-red-600 rounded-2xl font-black text-white uppercase text-sm active:scale-95 shadow-lg">Out on Base</button><button onClick={()=>setSelectedBase(null)}className="mt-4 py-2 text-slate-500 font-black uppercase text-[11px] tracking-widest text-center">Cancel</button></div></div></div>)}{substitutingInGame&&(<div className="fixed inset-0 z-[60] flex items-center justify-center bg-black/90 p-6 backdrop-blur-md"><div className="bg-slate-900 p-6 rounded-[2rem] border-2 border-white/10 w-full max-w-sm max-h-[80vh] overflow-hidden flex flex-col shadow-2xl animate-slide-up"><div className="flex justify-between items-center mb-6"><div className="flex flex-col"><h3 className="font-black uppercase tracking-widest text-cyan-400">Substitution</h3><span className="text-[10px] font-bold text-slate-500">Pos:{substitutingInGame.pos}</span></div><button onClick={()=>setSubstitutingInGame(null)}className="text-3xl font-black text-slate-600">Ã—</button></div><div className="flex-1 overflow-y-auto space-y-3 pr-1 pb-10">{battingSubstitutes.length>0?battingSubstitutes.map(p=>(<PlayerCard key={p.id}player={p}compact onClick={()=>{const{idx,pos,oldId}=substitutingInGame;const nl={...lineup};nl[pos]=p.id;setLineup(nl);const nOrder=[...battingOrder];nOrder[idx]={...nOrder[idx],playerId:p.id};setBattingOrder(nOrder);setGameState(prev=>{const newBases={...prev.bases};Object.keys(newBases).forEach(baseNum=>{if(newBases[baseNum]===oldId){newBases[baseNum]=p.id}});return{...prev,bases:newBases}});setSubstitutingInGame(null)}}/>)):<p className="text-center py-20 text-slate-700 font-black italic">No Bench Players Left</p>}</div></div></div>)}</div>);
if(isLoading){return(<div className="max-w-lg lg:max-w-5xl mx-auto bg-slate-950 min-h-screen flex items-center justify-center"><div className="text-center"><div className="animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-400 mx-auto mb-4"></div><p className="text-slate-400 font-bold">è¼‰å…¥ä¸­...</p></div></div>)}
return(<div className="min-h-screen pb-32 max-w-lg lg:max-w-5xl mx-auto bg-slate-950 shadow-2xl relative border-x border-white/5"><header className="sticky top-0 z-40 bg-slate-900/95 backdrop-blur-md border-b border-white/10 p-5 shadow-lg flex justify-between items-center"><h1 className="text-2xl font-black italic tracking-tighter bg-clip-text text-transparent bg-gradient-to-r from-cyan-400 to-indigo-600 uppercase">Pro Manager</h1><div className="flex items-center gap-3">{isSynced&&(<div className="flex items-center gap-1.5 text-xs text-emerald-400 bg-emerald-950/50 px-2 py-1 rounded-full border border-emerald-800"><span className="sync-indicator"></span>å·²åŒæ­¥</div>)}<div className="text-[10px] font-black text-slate-500 uppercase px-3 py-1 bg-slate-900 rounded-full border border-white/10">Active:{players.length}</div></div></header><main className="p-4 sm:p-6">{activeTab==='field'&&(<div className="animate-slide-up space-y-8"><div className="bg-slate-900 p-4 rounded-3xl border border-white/10 flex justify-between items-center shadow-xl mb-6"><h2 className="font-black italic text-cyan-400 uppercase tracking-widest text-sm">Defense Setup</h2><button onClick={autoOptimizeDefense}className="text-[10px] font-black bg-purple-700/50 text-purple-400 px-4 py-2 rounded-full border border-purple-500/30 active:scale-95 shadow-lg">ğŸ¯ è‡ªå‹•æœ€ä½³åŒ–å®ˆå‚™</button></div><div className="baseball-field relative overflow-hidden card-shadow mx-auto max-w-[450px]"><div className="diamond-inner"/>{ALL_POSITIONS.slice(0,10).map((pos,i)=>{const coords=[{t:'55%',l:'50%'},{t:'78%',l:'50%'},{t:'45%',l:'82%'},{t:'25%',l:'65%'},{t:'45%',l:'18%'},{t:'25%',l:'35%'},{t:'15%',l:'15%'},{t:'8%',l:'50%'},{t:'15%',l:'85%'},{t:'35%',l:'50%'}][i];return renderFieldSlot(pos,coords.t,coords.l)})}</div><div className="grid grid-cols-3 gap-3">{['DH1','DH2','DH3'].map(dh=>(<div key={dh}onClick={()=>setSelectingPosition(dh)}className={`p-4 rounded-2xl border-2 flex flex-col items-center justify-center transition-all cursor-pointer ${lineup[dh]?'bg-indigo-900/80 border-indigo-400 shadow-md':'bg-slate-900 border-slate-800 opacity-60'}`}><span className="text-[10px] text-white/40 font-black mb-1 uppercase">{dh}</span><span className="text-sm font-black truncate text-white">{players.find(x=>x.id===lineup[dh])?.name||'---'}</span></div>))}</div><div className="pt-6 border-t border-white/5"><h3 className="text-[10px] font-black text-slate-500 mb-4 uppercase tracking-widest px-1">æ¿å‡³çƒå“¡(Bench)</h3><div className="grid grid-cols-2 md:grid-cols-4 gap-3">{bench.length>0?bench.map(p=><PlayerCard key={p.id}player={p}compact/>):<p className="col-span-full text-center text-xs text-slate-700 py-6 font-bold uppercase tracking-widest">Empty Bench</p>}</div></div></div>)}{activeTab==='batting'&&(<div className="animate-slide-up space-y-6"><div className="bg-slate-900 p-5 rounded-3xl border border-white/10 flex justify-between items-center shadow-xl"><h2 className="font-black italic text-cyan-400 uppercase tracking-widest text-sm">Lineup Builder</h2><div className="flex gap-4 items-center"><button onClick={autoOptimizeBatting}className="text-[10px] font-black bg-cyan-700/50 text-cyan-400 px-4 py-2 rounded-full border border-cyan-500/30 active:scale-95 shadow-lg">ğŸª„ è‡ªå‹•æœ€ä½³åŒ–æ‰“ç·š</button><label className="flex items-center gap-2 text-[11px] text-slate-400 font-black uppercase cursor-pointer"><input type="checkbox"checked={pitcherBats}onChange={e=>setPitcherBats(e.target.checked)}className="accent-cyan-500"/>P Bats</label></div></div><div className="grid grid-cols-1 md:grid-cols-2 gap-6"><div className="space-y-2">{battingOrder.length>0?battingOrder.map((e,i)=>(<div key={i}className="flex items-center gap-4 bg-slate-900/80 p-4 rounded-2xl border border-white/5 shadow-md"><div className="w-9 h-9 flex items-center justify-center bg-slate-950 rounded-xl font-black text-cyan-400 border border-cyan-900/30 text-lg">{i+1}</div><div className="flex-1"><span className="font-black text-base text-white">{players.find(p=>p.id===e.playerId)?.name}</span><span className="text-[10px] text-slate-500 ml-3 uppercase font-black">{e.position}</span></div><div className="flex gap-2"><button onClick={()=>{const n=[...battingOrder];if(i>0)[n[i],n[i-1]]=[n[i-1],n[i]];setBattingOrder(n)}}className="p-3 bg-slate-800 rounded-xl active:bg-slate-700">â–²</button><button onClick={()=>{const n=[...battingOrder];if(i<n.length-1)[n[i],n[i+1]]=[n[i+1],n[i]];setBattingOrder(n)}}className="p-3 bg-slate-800 rounded-xl active:bg-slate-700">â–¼</button></div></div>)):<p className="text-center text-sm text-slate-700 py-16 font-black border-2 border-dashed border-slate-900 rounded-[2rem] uppercase tracking-widest">Build Lineup First</p>}</div><div className="space-y-4"><h3 className="text-[11px] font-black text-slate-500 uppercase tracking-widest px-1">Substitute Pool</h3><div className="grid grid-cols-1 sm:grid-cols-2 gap-3">{battingSubstitutes.map(p=><PlayerCard key={p.id}player={p}compact/>)}</div></div></div></div>)}{activeTab==='game'&&renderGameView()}{activeTab==='roster'&&(<div className="animate-slide-up space-y-6"><div className="bg-slate-900 p-6 rounded-3xl border border-white/10 grid grid-cols-2 gap-3 shadow-xl"><button onClick={()=>setEditingPlayer({secondaryPositions:[],stats:{power:50,contact:50,speed:50,defense:50}})}className="col-span-2 bg-cyan-600 py-4 rounded-2xl text-sm font-black shadow-lg uppercase tracking-widest active:scale-95 transition-all">ï¼‹ Add New Player</button><button onClick={handleExportExcel}className="bg-slate-800 py-3.5 rounded-2xl text-[11px] font-black uppercase tracking-widest shadow-md">ğŸ“¥ Export Excel</button><label className="bg-slate-800 py-3.5 rounded-2xl text-[11px] font-black text-center cursor-pointer uppercase tracking-widest shadow-md">ğŸ“¤ Import Excel<input type="file"className="hidden"accept=".xlsx,.xls"onChange={handleImportExcel}/></label></div><div className="grid grid-cols-1 sm:grid-cols-2 gap-4">{players.map(p=>(<div key={p.id}className="relative group"><div onClick={()=>setEditingPlayer(p)}className="cursor-pointer"><PlayerCard player={p}/></div><button onClick={(e)=>{e.stopPropagation();handleDeletePlayer(p.id)}}className="absolute -top-1 -right-1 bg-red-600 w-8 h-8 rounded-full text-white font-black text-lg shadow-xl z-30 transition-all active:scale-90 flex items-center justify-center cursor-pointer border-2 border-white">Ã—</button></div>))}</div></div>)}</main><nav className="fixed bottom-0 left-1/2 -translate-x-1/2 w-full max-w-lg lg:max-w-5xl bg-slate-900/95 backdrop-blur-2xl border-t border-white/10 flex justify-around items-center h-24 px-4 pb-6 pt-2 z-40">{[{id:'field',icon:'ğŸŸï¸',label:'Field'},{id:'batting',icon:'âš¡',label:'Lineup'},{id:'game',icon:'âš¾',label:'Game'},{id:'roster',icon:'ğŸ“‡',label:'Roster'}].map(t=>(<button key={t.id}onClick={()=>setActiveTab(t.id)}className={`flex-1 flex flex-col items-center gap-2 transition-all ${activeTab===t.id?'text-cyan-400 scale-110 font-black':'text-slate-500 opacity-60'}`}><span className="text-2xl">{t.icon}</span><span className="text-[10px] font-black uppercase tracking-widest">{t.label}</span></button>))}</nav>{selectingPosition&&(<div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center bg-black/95 p-0 sm:p-4 backdrop-blur-md animate-fade-in"><div className="bg-slate-900 w-full max-w-md rounded-t-[2.5rem] sm:rounded-[2.5rem] border-t-2 sm:border-2 border-white/10 p-8 shadow-2xl overflow-y-auto max-h-[85vh]"><div className="flex justify-between items-center mb-8"><div className="flex flex-col"><h3 className="font-black text-2xl uppercase tracking-widest text-white">Select <span className="text-cyan-400">{selectingPosition}</span></h3><span className="text-[11px] text-slate-500 font-black uppercase tracking-widest mt-1 italic">Primary>Secondary>Avg</span></div><button onClick={()=>setSelectingPosition(null)}className="text-4xl font-black text-slate-600">Ã—</button></div><div className="space-y-4 pb-12">{sortedPlayersForSelection.length>0?sortedPlayersForSelection.map(p=>(<PlayerCard key={p.id}player={p}selected={lineup[selectingPosition]===p.id}onClick={()=>assignPlayer(p.id)}/>)):<p className="text-center py-24 text-slate-700 font-black italic uppercase tracking-widest">No available players</p>}<button onClick={()=>{const nl={...lineup};delete nl[selectingPosition];setLineup(nl);setSelectingPosition(null)}}className="w-full py-5 rounded-3xl bg-slate-800/80 text-red-500 font-black mt-6 uppercase tracking-widest shadow-lg">Clear Position</button></div></div></div>)}{editingPlayer&&(<div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/98 backdrop-blur-2xl"><div className="bg-slate-900 w-full max-w-md rounded-[3rem] border-2 border-white/10 p-10 shadow-2xl overflow-y-auto max-h-[95vh] animate-slide-up"><h3 className="text-2xl font-black mb-8 text-center italic uppercase tracking-tighter text-cyan-400">Player profile</h3><div className="space-y-6"><div className="space-y-1.5"><label className="text-[11px] font-black text-cyan-500 uppercase tracking-widest ml-1">Name</label><input value={editingPlayer.name||''}onChange={e=>setEditingPlayer({...editingPlayer,name:e.target.value})}className="w-full bg-slate-800 rounded-3xl px-6 py-3.5 text-white font-black outline-none border border-white/5 focus:border-cyan-500 transition-all text-lg shadow-inner"placeholder="Enter name"/></div><div className="grid grid-cols-2 gap-5"><div className="space-y-1.5"><label className="text-[11px] font-black text-cyan-500 uppercase ml-1"># Number</label><input value={editingPlayer.number||''}onChange={e=>setEditingPlayer({...editingPlayer,number:e.target.value})}className="w-full bg-slate-800 rounded-3xl px-6 py-3.5 font-black outline-none border border-white/5 shadow-inner"/></div><div className="space-y-1.5"><label className="text-[11px] font-black text-cyan-500 uppercase ml-1">Primary Pos</label><select value={editingPlayer.primaryPosition||'P'}onChange={e=>setEditingPlayer({...editingPlayer,primaryPosition:e.target.value})}className="w-full bg-slate-800 rounded-3xl px-6 py-3.5 font-black outline-none border border-white/5 shadow-inner appearance-none">{ALL_POSITIONS.map(p=><option key={p}value={p}>{p}</option>)}</select></div></div><div className="space-y-3"><label className="text-[11px] font-black text-cyan-500 uppercase tracking-widest ml-1">Secondary Position</label><div className="grid grid-cols-4 gap-2">{ALL_POSITIONS.map(pos=>{const isS=editingPlayer.secondaryPositions?.includes(pos);return<button key={pos}onClick={()=>{const c=editingPlayer.secondaryPositions||[];setEditingPlayer({...editingPlayer,secondaryPositions:isS?c.filter(x=>x!==pos):[...c,pos]})}}className={`text-[10px] font-black py-2 rounded-xl border transition-all ${isS?'bg-cyan-600 border-cyan-400 text-white shadow-lg':'bg-slate-800 border-slate-700 opacity-40 text-slate-500'}`}>{pos}</button>})}</div></div><div className="grid grid-cols-2 gap-4 border-t border-white/10 pt-6">{['power','contact','speed','defense'].map(s=><div key={s}className="bg-slate-950/80 p-3 rounded-2xl border border-white/5 shadow-inner"><label className="block text-[9px] font-black text-slate-500 uppercase mb-1 tracking-tighter">{s}</label><input type="number"value={editingPlayer.stats?.[s]??50}onChange={e=>setEditingPlayer({...editingPlayer,stats:{...(editingPlayer.stats||{}),[s]:parseInt(e.target.value)||0}})}className="w-full bg-transparent font-black text-xl outline-none text-white"/></div>)}</div></div><div className="flex gap-4 mt-10"><button onClick={()=>setEditingPlayer(null)}className="flex-1 py-4 rounded-3xl bg-slate-800 text-slate-500 font-black text-xs uppercase tracking-widest active:bg-slate-700 transition-all">Cancel</button><button onClick={()=>{if(!editingPlayer.name)return;const p={...editingPlayer,id:editingPlayer.id||Date.now().toString(),secondaryPositions:editingPlayer.secondaryPositions||[],stats:editingPlayer.stats||{power:50,contact:50,speed:50,defense:50}};if(editingPlayer.id)setPlayers(prev=>prev.map(x=>x.id===p.id?p:x));else setPlayers(prev=>[...prev,p]);setEditingPlayer(null)}}className="flex-1 py-4 rounded-3xl bg-cyan-600 text-white font-black text-xs shadow-xl uppercase tracking-widest transition-all active:scale-95">Save Profile</button></div></div></div>)}</div>)};
const root=ReactDOM.createRoot(document.getElementById('root'));root.render(<App/>);
</script>
</body>
</html>